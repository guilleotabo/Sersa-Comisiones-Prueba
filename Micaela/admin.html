<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administración - Sistema de Comisiones</title>
    <style>
        body {
            font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
            background:#f5f6f8;
            margin:0;
            padding:5px;
            color:#333;
            font-size:12px;
        }
        .container {
            background:#fff;
            padding:5px;
            margin:0 auto;
        }
        h1 {
            font-size: 18px;
            margin: 0;
            color: #006D77;
            font-weight: 600;
        }
        h2 {
            font-size: 14px;
            margin: 15px 0 8px 0;
            color: #006D77;
            font-weight: 600;
        }
        .compact-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
            font-size: 12px;
        }
        th, td {
            padding: 5px 8px;
            border: 1px solid #ddd;
            text-align: left;
        }
        th {
            background:#006D77;
            color:#fff;
        }
        input[type="text"], input[type="number"] {
            height: 28px;
            font-size: 12px;
            padding: 4px 6px;
            border: 1px solid #ddd;
            border-radius: 3px;
            width: 100%;
        }
        input:focus { outline:none; border-color:#006D77; }
        .grid-4 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .grid-4 td:first-child,.grid-4 th:first-child,
        .grid-3 td:first-child,.grid-3 th:first-child{max-width:50px;}
        @media(max-width:768px){
            .grid-4{grid-template-columns:repeat(2,1fr);} .grid-3{grid-template-columns:repeat(2,1fr);} }
        .button-group {
            margin-top: 20px;
            text-align: center;
        }
        button {
            height: 34px;
            font-size: 13px;
            padding: 6px 16px;
            margin: 0 5px;
            background: #006D77;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background 0.2s;
        }
        button:hover {
            background: #00565e;
        }
        .preview{background:#4CAF50;}
        .save-local{background:#2196F3;}
        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .header-title {
            flex: 2;
        }
        .header-base {
            flex: 1;
            min-width: 200px;
            max-width: 250px;
        }
        .mult-wrap {
            width: 100%;
            border-collapse: collapse;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        .mult-wrap td {
            vertical-align: top;
            padding: 0;
        }
        .mult-table {
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .mult-table th {
            background: #006D77;
            text-align: center;
            padding: 8px;
        }
        .mult-table td {
            padding: 5px;
        }
        .mult-row:nth-child(even) {
            background: #f8f9fa;
        }
        .mult-row:hover {
            background: #e3f2fd;
        }
        .success{
            background:#E8F5E9;
            border-left:4px solid #4CAF50;
            padding:4px;
            margin:5px 0;
            display:none;
        }
        .output-section{
            margin-top:5px;
            display:none;
        }
        textarea{
            width:100%;
            height:250px;
            font-family:monospace;
            font-size:12px;
            padding:5px;
            border:1px solid #ddd;
        }
        /* Mejoras visuales */
        th {
            background: #006D77;
            color: white;
            font-weight: 500;
            font-size: 11px;
        }

        tr:nth-child(even) {
            background: #f8f9fa;
        }

        input:focus {
            outline: none;
            border-color: #006D77;
            box-shadow: 0 0 0 2px rgba(0,109,119,0.2);
        }

        .compact-table:hover {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .main-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
            margin-bottom: 15px;
        }
        
        .main-buttons button {
            min-width: 150px;
            height: 40px;
            font-size: 14px;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-save {
            background: #2196F3;
        }
        
        .btn-export {
            background: #4CAF50;
        }
        
        .btn-restore {
            background: #FF9800;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header-section">
        <div class="header-title">
            <h1>⚙️ Administración del Sistema de Comisiones</h1>
        </div>
        <div class="header-base">
            <table class="compact-table">
                <tr>
                    <th>Base Fija</th>
                    <td><input type="text" id="base" onkeyup="formatearInput(this)"></td>
                </tr>
            </table>
        </div>
    </div>

    <h2>Metas por Nivel</h2>
    <div class="grid-4">
        <div>
        <table class="compact-table">
            <tr><th>Nivel</th><th>Monto Interno (Gs)</th></tr>
            <tr><td>Capilla</td><td><input type="text" id="meta-interno-0" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Junior</td><td><input type="text" id="meta-interno-1" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Senior A</td><td><input type="text" id="meta-interno-2" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Senior B</td><td><input type="text" id="meta-interno-3" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Máster</td><td><input type="text" id="meta-interno-4" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Genio</td><td><input type="text" id="meta-interno-5" onkeyup="formatearInput(this)"></td></tr>
        </table>
        <table class="compact-table">
            <tr><th>Nivel</th><th>Monto Externo (Gs)</th></tr>
            <tr><td>Capilla</td><td><input type="text" id="meta-externo-0" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Junior</td><td><input type="text" id="meta-externo-1" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Senior A</td><td><input type="text" id="meta-externo-2" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Senior B</td><td><input type="text" id="meta-externo-3" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Máster</td><td><input type="text" id="meta-externo-4" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Genio</td><td><input type="text" id="meta-externo-5" onkeyup="formatearInput(this)"></td></tr>
        </table>
        </div>
        <div>
        <table class="compact-table">
            <tr><th>Nivel</th><th>Recuperados (Gs)</th></tr>
            <tr><td>Capilla</td><td><input type="text" id="meta-recuperado-0" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Junior</td><td><input type="text" id="meta-recuperado-1" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Senior A</td><td><input type="text" id="meta-recuperado-2" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Senior B</td><td><input type="text" id="meta-recuperado-3" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Máster</td><td><input type="text" id="meta-recuperado-4" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Genio</td><td><input type="text" id="meta-recuperado-5" onkeyup="formatearInput(this)"></td></tr>
        </table>
        <table class="compact-table">
            <tr><th>Nivel</th><th>Cantidad Desembolsos</th></tr>
            <tr><td>Capilla</td><td><input type="number" id="meta-cantidad-0"></td></tr>
            <tr><td>Junior</td><td><input type="number" id="meta-cantidad-1"></td></tr>
            <tr><td>Senior A</td><td><input type="number" id="meta-cantidad-2"></td></tr>
            <tr><td>Senior B</td><td><input type="number" id="meta-cantidad-3"></td></tr>
            <tr><td>Máster</td><td><input type="number" id="meta-cantidad-4"></td></tr>
            <tr><td>Genio</td><td><input type="number" id="meta-cantidad-5"></td></tr>
        </table>
        </div>
    </div>

    <h2>Premios por Nivel</h2>
    <div class="grid-3">
        <div>
        <table class="compact-table">
            <tr><th>Nivel</th><th>Premio Carrera (Gs)</th></tr>
            <tr><td>Capilla</td><td><input type="text" id="premio-carrera-0" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Junior</td><td><input type="text" id="premio-carrera-1" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Senior A</td><td><input type="text" id="premio-carrera-2" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Senior B</td><td><input type="text" id="premio-carrera-3" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Máster</td><td><input type="text" id="premio-carrera-4" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Genio</td><td><input type="text" id="premio-carrera-5" onkeyup="formatearInput(this)"></td></tr>
        </table>
        <table class="compact-table">
            <tr><th>Nivel</th><th>Premio Interno (Gs)</th></tr>
            <tr><td>Capilla</td><td><input type="text" id="premio-interno-0" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Junior</td><td><input type="text" id="premio-interno-1" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Senior A</td><td><input type="text" id="premio-interno-2" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Senior B</td><td><input type="text" id="premio-interno-3" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Máster</td><td><input type="text" id="premio-interno-4" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Genio</td><td><input type="text" id="premio-interno-5" onkeyup="formatearInput(this)"></td></tr>
        </table>
        <table class="compact-table">
            <tr><th>Nivel</th><th>Premio Externo (Gs)</th></tr>
            <tr><td>Capilla</td><td><input type="text" id="premio-externo-0" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Junior</td><td><input type="text" id="premio-externo-1" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Senior A</td><td><input type="text" id="premio-externo-2" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Senior B</td><td><input type="text" id="premio-externo-3" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Máster</td><td><input type="text" id="premio-externo-4" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Genio</td><td><input type="text" id="premio-externo-5" onkeyup="formatearInput(this)"></td></tr>
        </table>
        </div>
        <div>
        <table class="compact-table">
            <tr><th>Nivel</th><th>Premio Recuperados (Gs)</th></tr>
            <tr><td>Capilla</td><td><input type="text" id="premio-recuperado-0" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Junior</td><td><input type="text" id="premio-recuperado-1" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Senior A</td><td><input type="text" id="premio-recuperado-2" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Senior B</td><td><input type="text" id="premio-recuperado-3" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Máster</td><td><input type="text" id="premio-recuperado-4" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Genio</td><td><input type="text" id="premio-recuperado-5" onkeyup="formatearInput(this)"></td></tr>
        </table>
        <table class="compact-table">
            <tr><th>Nivel</th><th>Premio Cantidad (Gs)</th></tr>
            <tr><td>Capilla</td><td><input type="text" id="premio-cantidad-0" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Junior</td><td><input type="text" id="premio-cantidad-1" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Senior A</td><td><input type="text" id="premio-cantidad-2" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Senior B</td><td><input type="text" id="premio-cantidad-3" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Máster</td><td><input type="text" id="premio-cantidad-4" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Genio</td><td><input type="text" id="premio-cantidad-5" onkeyup="formatearInput(this)"></td></tr>
        </table>
        <table class="compact-table">
            <tr><th>Nivel</th><th>Premio Equipo (Gs)</th></tr>
            <tr><td>Capilla</td><td><input type="text" id="premio-equipo-0" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Junior</td><td><input type="text" id="premio-equipo-1" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Senior A</td><td><input type="text" id="premio-equipo-2" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Senior B</td><td><input type="text" id="premio-equipo-3" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Máster</td><td><input type="text" id="premio-equipo-4" onkeyup="formatearInput(this)"></td></tr>
            <tr><td>Genio</td><td><input type="text" id="premio-equipo-5" onkeyup="formatearInput(this)"></td></tr>
        </table>
        </div>
    </div>

    <h2>Multiplicadores</h2>
    <div class="mult-wrap">
        <div class="mult-table">
            <table class="compact-table">
                <tr><th colspan="3">Conversión</th></tr>
                <tr><th>Desde %</th><th>Multiplicador</th><th>Texto</th></tr>
                <tr class="mult-row"><td><input type="number" id="mult-conv-min-0" oninput="clearErrorOnEdit()"></td><td><input type="number" id="mult-conv-val-0" step="0.01" oninput="clearErrorOnEdit()"></td><td><input type="text" id="mult-conv-text-0"></td></tr>
                <tr class="mult-row"><td><input type="number" id="mult-conv-min-1" oninput="clearErrorOnEdit()"></td><td><input type="number" id="mult-conv-val-1" step="0.01" oninput="clearErrorOnEdit()"></td><td><input type="text" id="mult-conv-text-1"></td></tr>
                <tr class="mult-row"><td><input type="number" id="mult-conv-min-2" oninput="clearErrorOnEdit()"></td><td><input type="number" id="mult-conv-val-2" step="0.01" oninput="clearErrorOnEdit()"></td><td><input type="text" id="mult-conv-text-2"></td></tr>
                <tr class="mult-row"><td><input type="number" id="mult-conv-min-3" oninput="clearErrorOnEdit()"></td><td><input type="number" id="mult-conv-val-3" step="0.01" oninput="clearErrorOnEdit()"></td><td><input type="text" id="mult-conv-text-3"></td></tr>
                <tr class="mult-row"><td><input type="number" id="mult-conv-min-4" oninput="clearErrorOnEdit()"></td><td><input type="number" id="mult-conv-val-4" step="0.01" oninput="clearErrorOnEdit()"></td><td><input type="text" id="mult-conv-text-4"></td></tr>
                <tr class="mult-row"><td><input type="number" id="mult-conv-min-5" oninput="clearErrorOnEdit()"></td><td><input type="number" id="mult-conv-val-5" step="0.01" oninput="clearErrorOnEdit()"></td><td><input type="text" id="mult-conv-text-5"></td></tr>
                <tr class="mult-row"><td><input type="number" id="mult-conv-min-6" oninput="clearErrorOnEdit()"></td><td><input type="number" id="mult-conv-val-6" step="0.01" oninput="clearErrorOnEdit()"></td><td><input type="text" id="mult-conv-text-6"></td></tr>
            </table>
        </div>
        <div class="mult-table">
            <table class="compact-table">
                <tr><th colspan="3">Empatía</th></tr>
                <tr><th>Desde %</th><th>Multiplicador</th><th>Texto</th></tr>
                <tr class="mult-row"><td><input type="number" id="mult-emp-min-0" oninput="clearErrorOnEdit()"></td><td><input type="number" id="mult-emp-val-0" step="0.01" oninput="clearErrorOnEdit()"></td><td><input type="text" id="mult-emp-text-0"></td></tr>
                <tr class="mult-row"><td><input type="number" id="mult-emp-min-1" oninput="clearErrorOnEdit()"></td><td><input type="number" id="mult-emp-val-1" step="0.01" oninput="clearErrorOnEdit()"></td><td><input type="text" id="mult-emp-text-1"></td></tr>
                <tr class="mult-row"><td><input type="number" id="mult-emp-min-2" oninput="clearErrorOnEdit()"></td><td><input type="number" id="mult-emp-val-2" step="0.01" oninput="clearErrorOnEdit()"></td><td><input type="text" id="mult-emp-text-2"></td></tr>
                <tr class="mult-row"><td><input type="number" id="mult-emp-min-3" oninput="clearErrorOnEdit()"></td><td><input type="number" id="mult-emp-val-3" step="0.01" oninput="clearErrorOnEdit()"></td><td><input type="text" id="mult-emp-text-3"></td></tr>
                <tr class="mult-row"><td><input type="number" id="mult-emp-min-4" oninput="clearErrorOnEdit()"></td><td><input type="number" id="mult-emp-val-4" step="0.01" oninput="clearErrorOnEdit()"></td><td><input type="text" id="mult-emp-text-4"></td></tr>
            </table>
        </div>
        <div class="mult-table">
            <table class="compact-table">
                <tr><th colspan="3">Proceso</th></tr>
                <tr><th>Desde %</th><th>Multiplicador</th><th>Texto</th></tr>
                <tr class="mult-row"><td><input type="number" id="mult-proc-min-0" oninput="clearErrorOnEdit()"></td><td><input type="number" id="mult-proc-val-0" step="0.01" oninput="clearErrorOnEdit()"></td><td><input type="text" id="mult-proc-text-0"></td></tr>
                <tr class="mult-row"><td><input type="number" id="mult-proc-min-1" oninput="clearErrorOnEdit()"></td><td><input type="number" id="mult-proc-val-1" step="0.01" oninput="clearErrorOnEdit()"></td><td><input type="text" id="mult-proc-text-1"></td></tr>
                <tr class="mult-row"><td><input type="number" id="mult-proc-min-2" oninput="clearErrorOnEdit()"></td><td><input type="number" id="mult-proc-val-2" step="0.01" oninput="clearErrorOnEdit()"></td><td><input type="text" id="mult-proc-text-2"></td></tr>
                <tr class="mult-row"><td><input type="number" id="mult-proc-min-3" oninput="clearErrorOnEdit()"></td><td><input type="number" id="mult-proc-val-3" step="0.01" oninput="clearErrorOnEdit()"></td><td><input type="text" id="mult-proc-text-3"></td></tr>
                <tr class="mult-row"><td><input type="number" id="mult-proc-min-4" oninput="clearErrorOnEdit()"></td><td><input type="number" id="mult-proc-val-4" step="0.01" oninput="clearErrorOnEdit()"></td><td><input type="text" id="mult-proc-text-4"></td></tr>
            </table>
        </div>
        <div class="mult-table">
            <table class="compact-table">
                <tr><th colspan="3">Mora</th></tr>
                <tr><th>Desde %</th><th>Multiplicador</th><th>Texto</th></tr>
                <tr class="mult-row"><td><input type="number" id="mult-mora-min-0" oninput="clearErrorOnEdit()"></td><td><input type="number" id="mult-mora-val-0" step="0.01" oninput="clearErrorOnEdit()"></td><td><input type="text" id="mult-mora-text-0"></td></tr>
                <tr class="mult-row"><td><input type="number" id="mult-mora-min-1" oninput="clearErrorOnEdit()"></td><td><input type="number" id="mult-mora-val-1" step="0.01" oninput="clearErrorOnEdit()"></td><td><input type="text" id="mult-mora-text-1"></td></tr>
                <tr class="mult-row"><td><input type="number" id="mult-mora-min-2" oninput="clearErrorOnEdit()"></td><td><input type="number" id="mult-mora-val-2" step="0.01" oninput="clearErrorOnEdit()"></td><td><input type="text" id="mult-mora-text-2"></td></tr>
                <tr class="mult-row"><td><input type="number" id="mult-mora-min-3" oninput="clearErrorOnEdit()"></td><td><input type="number" id="mult-mora-val-3" step="0.01" oninput="clearErrorOnEdit()"></td><td><input type="text" id="mult-mora-text-3"></td></tr>
                <tr class="mult-row"><td><input type="number" id="mult-mora-min-4" oninput="clearErrorOnEdit()"></td><td><input type="number" id="mult-mora-val-4" step="0.01" oninput="clearErrorOnEdit()"></td><td><input type="text" id="mult-mora-text-4"></td></tr>
            </table>
        </div>
    </div>

    <div class="main-buttons">
        <button class="btn-save" onclick="saveToLocal()">💾 Guardar</button>
        <button class="btn-export" onclick="generateConfig()">📄 Exportar config.js</button>
        <button class="btn-restore" onclick="resetDefaults()">🔄 Restaurar valores por defecto</button>
    </div>

    <div id="errorMsg" style="color:#b71c1c;background:#ffebee;border-left:4px solid #b71c1c;padding:8px;margin:5px 0;display:none;border-radius:3px;"></div>
    <div class="success" id="saveSuccess">✅ Configuración guardada en el navegador exitosamente</div>

    <div class="output-section" id="outputSection">
        <h2>📄 Nuevo config.js generado</h2>
        <textarea id="configOutput" readonly></textarea>
        <div class="button-group">
            <button onclick="copyToClipboard()">📋 Copiar</button>
            <button onclick="downloadConfig()">💾 Descargar</button>
        </div>
    </div>
</div>
    <script src="config.js"></script>
    <script>
        // Formatear número con puntos
        function formatearGuaranies(num) {
            return Math.round(num).toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }
        
        // Remover formato para obtener número
        function limpiarFormato(str) {
            return str.replace(/\./g, '');
        }
        
        // Formatear input mientras se escribe
        function formatearInput(input) {
            const valor = limpiarFormato(input.value);
            if (valor) {
                input.value = formatearGuaranies(parseInt(valor, 10));
            }
        }
        
        // Limpiar errores al editar multiplicadores
        function clearErrorOnEdit() {
            const errorMsg = document.getElementById('errorMsg');
            if (errorMsg) errorMsg.style.display = 'none';
        }
        
        // Cargar valores desde config.js o localStorage
        function loadValues() {
            console.log('Iniciando carga de valores...');
            
            // Verificar si CONFIG existe
            if (typeof CONFIG === 'undefined') {
                console.error('CONFIG no está definido. Problema con config.js');
                const errorDiv = document.getElementById('errorMsg');
                if (errorDiv) {
                    errorDiv.innerHTML = '❌ <strong>Error crítico:</strong> No se pudo cargar config.js. Verifica que el archivo existe y está bien formateado.';
                    errorDiv.style.display = 'block';
                }
                return;
            }
            
            console.log('CONFIG cargado:', CONFIG);
            
            const savedConfig = localStorage.getItem('comisionesConfig');
            const config = savedConfig ? JSON.parse(savedConfig) : CONFIG;
            
            console.log('Configuración a usar:', config);
            
            // Base
            try {
                document.getElementById('base').value = formatearGuaranies(config.base);
                console.log('Base cargada:', config.base);
            } catch (e) {
                console.error('Error cargando base:', e);
            }
            
            // Metas
            try {
                for (let i = 0; i < 6; i++) {
                    document.getElementById(`meta-interno-${i}`).value = formatearGuaranies(config.metas.montoInterno[i]);
                    document.getElementById(`meta-externo-${i}`).value = formatearGuaranies(config.metas.montoExterno[i]);
                    document.getElementById(`meta-recuperado-${i}`).value = formatearGuaranies(config.metas.montoRecuperado[i]);
                    document.getElementById(`meta-cantidad-${i}`).value = config.metas.cantidad[i];
                }
                console.log('Metas cargadas correctamente');
            } catch (e) {
                console.error('Error cargando metas:', e);
            }
            
            // Premios
            try {
                for (let i = 0; i < 6; i++) {
                    document.getElementById(`premio-carrera-${i}`).value = formatearGuaranies(config.pagos.carrera[i]);
                    document.getElementById(`premio-interno-${i}`).value = formatearGuaranies(config.pagos.montoInterno[i]);
                    document.getElementById(`premio-externo-${i}`).value = formatearGuaranies(config.pagos.montoExterno[i]);
                    document.getElementById(`premio-recuperado-${i}`).value = formatearGuaranies(config.pagos.montoRecuperado[i]);
                    document.getElementById(`premio-cantidad-${i}`).value = formatearGuaranies(config.pagos.cantidad[i]);
                    document.getElementById(`premio-equipo-${i}`).value = formatearGuaranies(config.pagos.equipo[i]);
                }
                console.log('Premios cargados correctamente');
            } catch (e) {
                console.error('Error cargando premios:', e);
            }
            
            // Multiplicadores
            try {
                for (let i = 0; i < config.multiplicadores.conversion.length; i++) {
                    if (document.getElementById(`mult-conv-min-${i}`)) {
                        document.getElementById(`mult-conv-min-${i}`).value = config.multiplicadores.conversion[i].min;
                        document.getElementById(`mult-conv-val-${i}`).value = config.multiplicadores.conversion[i].mult;
                        document.getElementById(`mult-conv-text-${i}`).value = config.multiplicadores.conversion[i].text;
                    }
                }
                console.log('Multiplicadores conversión cargados');
            } catch (e) {
                console.error('Error cargando multiplicadores conversión:', e);
            }
            
            try {
                for (let i = 0; i < config.multiplicadores.empatia.length; i++) {
                    if (document.getElementById(`mult-emp-min-${i}`)) {
                        document.getElementById(`mult-emp-min-${i}`).value = config.multiplicadores.empatia[i].min;
                        document.getElementById(`mult-emp-val-${i}`).value = config.multiplicadores.empatia[i].mult;
                        document.getElementById(`mult-emp-text-${i}`).value = config.multiplicadores.empatia[i].text;
                    }
                }
                console.log('Multiplicadores empatía cargados');
            } catch (e) {
                console.error('Error cargando multiplicadores empatía:', e);
            }
            
            try {
                for (let i = 0; i < config.multiplicadores.proceso.length; i++) {
                    if (document.getElementById(`mult-proc-min-${i}`)) {
                        document.getElementById(`mult-proc-min-${i}`).value = config.multiplicadores.proceso[i].min;
                        document.getElementById(`mult-proc-val-${i}`).value = config.multiplicadores.proceso[i].mult;
                        document.getElementById(`mult-proc-text-${i}`).value = config.multiplicadores.proceso[i].text;
                    }
                }
                console.log('Multiplicadores proceso cargados');
            } catch (e) {
                console.error('Error cargando multiplicadores proceso:', e);
            }
            
            try {
                for (let i = 0; i < config.multiplicadores.mora.length; i++) {
                    if (document.getElementById(`mult-mora-min-${i}`)) {
                        document.getElementById(`mult-mora-min-${i}`).value = config.multiplicadores.mora[i].min;
                        document.getElementById(`mult-mora-val-${i}`).value = config.multiplicadores.mora[i].mult;
                        document.getElementById(`mult-mora-text-${i}`).value = config.multiplicadores.mora[i].text;
                    }
                }
                console.log('Multiplicadores mora cargados');
            } catch (e) {
                console.error('Error cargando multiplicadores mora:', e);
            }
            
            console.log('Carga de valores completada');
        }
        
        // Validar y obtener configuración actual desde los inputs
        function getCurrentConfig() {
            const config = {
                base: parseInt(limpiarFormato(document.getElementById('base').value)),
                niveles: ['Capilla', 'Junior', 'Senior A', 'Senior B', 'Máster', 'Genio'],
                iconos: ['🏠', '👤', '⭐', '💎', '👑', '🏆'],
                metas: {
                    montoInterno: [],
                    montoExterno: [],
                    montoRecuperado: [],
                    cantidad: []
                },
                pagos: {
                    carrera: [],
                    montoInterno: [],
                    montoExterno: [],
                    montoRecuperado: [],
                    cantidad: [],
                    equipo: []
                },
                multiplicadores: {
                    conversion: [],
                    empatia: [],
                    proceso: [],
                    mora: []
                }
            };

            // Leer metas
            for (let i = 0; i < 6; i++) {
                config.metas.montoInterno.push(parseInt(limpiarFormato(document.getElementById(`meta-interno-${i}`).value)));
                config.metas.montoExterno.push(parseInt(limpiarFormato(document.getElementById(`meta-externo-${i}`).value)));
                config.metas.montoRecuperado.push(parseInt(limpiarFormato(document.getElementById(`meta-recuperado-${i}`).value)));
                config.metas.cantidad.push(parseInt(document.getElementById(`meta-cantidad-${i}`).value));
            }

            // Leer premios
            for (let i = 0; i < 6; i++) {
                config.pagos.carrera.push(parseInt(limpiarFormato(document.getElementById(`premio-carrera-${i}`).value)));
                config.pagos.montoInterno.push(parseInt(limpiarFormato(document.getElementById(`premio-interno-${i}`).value)));
                config.pagos.montoExterno.push(parseInt(limpiarFormato(document.getElementById(`premio-externo-${i}`).value)));
                config.pagos.montoRecuperado.push(parseInt(limpiarFormato(document.getElementById(`premio-recuperado-${i}`).value)));
                config.pagos.cantidad.push(parseInt(limpiarFormato(document.getElementById(`premio-cantidad-${i}`).value)));
                config.pagos.equipo.push(parseInt(limpiarFormato(document.getElementById(`premio-equipo-${i}`).value)));
            }

            // Leer multiplicadores con validación
            let multError = false;
            let multFields = [];
            // Conversión
            for (let i = 0; i < 7; i++) {
                let min = parseInt(document.getElementById(`mult-conv-min-${i}`).value);
                let mult = parseFloat(document.getElementById(`mult-conv-val-${i}`).value);
                let text = document.getElementById(`mult-conv-text-${i}`).value;
                multFields.push({id:`mult-conv-min-${i}`, valid:!isNaN(min) && min>=0});
                multFields.push({id:`mult-conv-val-${i}`, valid:!isNaN(mult) && mult>=0});
                if (isNaN(min) || isNaN(mult) || min<0 || mult<0) multError = true;
                config.multiplicadores.conversion.push({min, mult, text});
            }
            // Empatía
            for (let i = 0; i < 5; i++) {
                let min = parseInt(document.getElementById(`mult-emp-min-${i}`).value);
                let mult = parseFloat(document.getElementById(`mult-emp-val-${i}`).value);
                let text = document.getElementById(`mult-emp-text-${i}`).value;
                multFields.push({id:`mult-emp-min-${i}`, valid:!isNaN(min) && min>=0});
                multFields.push({id:`mult-emp-val-${i}`, valid:!isNaN(mult) && mult>=0});
                if (isNaN(min) || isNaN(mult) || min<0 || mult<0) multError = true;
                config.multiplicadores.empatia.push({min, mult, text});
            }
            // Proceso
            for (let i = 0; i < 5; i++) {
                let min = parseInt(document.getElementById(`mult-proc-min-${i}`).value);
                let mult = parseFloat(document.getElementById(`mult-proc-val-${i}`).value);
                let text = document.getElementById(`mult-proc-text-${i}`).value;
                multFields.push({id:`mult-proc-min-${i}`, valid:!isNaN(min) && min>=0});
                multFields.push({id:`mult-proc-val-${i}`, valid:!isNaN(mult) && mult>=0});
                if (isNaN(min) || isNaN(mult) || min<0 || mult<0) multError = true;
                config.multiplicadores.proceso.push({min, mult, text});
            }
            // Mora
            for (let i = 0; i < 5; i++) {
                let min = parseInt(document.getElementById(`mult-mora-min-${i}`).value);
                let mult = parseFloat(document.getElementById(`mult-mora-val-${i}`).value);
                let text = document.getElementById(`mult-mora-text-${i}`).value;
                multFields.push({id:`mult-mora-min-${i}`, valid:!isNaN(min) && min>=0});
                multFields.push({id:`mult-mora-val-${i}`, valid:!isNaN(mult) && mult>=0});
                if (isNaN(min) || isNaN(mult) || min<0 || mult<0) multError = true;
                config.multiplicadores.mora.push({min, mult, text});
            }

            // Resaltar campos inválidos y mostrar error
            const errorMsg = document.getElementById('errorMsg');
            multFields.forEach(f => {
                const el = document.getElementById(f.id);
                if (el) {
                    if (!f.valid) {
                        el.style.background = '#ffeaea';
                        el.style.borderColor = '#e53935';
                    } else {
                        el.style.background = '';
                        el.style.borderColor = '';
                    }
                }
            });
            if (multError) {
                if (errorMsg) {
                    errorMsg.innerHTML = '⚠️ <strong>Error en multiplicadores:</strong> Corrige los campos resaltados. Los valores no pueden estar vacíos, ser negativos o no numéricos.';
                    errorMsg.style.display = 'block';
                    errorMsg.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
                throw new Error('Hay valores inválidos en los multiplicadores. Corrige los campos resaltados.');
            } else {
                if (errorMsg) errorMsg.style.display = 'none';
            }
            return config;
        }
        
        // Previsualizar cambios
        function previewChanges() {
            try {
                const config = getCurrentConfig();
                // Calcular máximo subtotal
                const maxSubtotal = config.base + 
                    config.pagos.carrera[5] + 
                    config.pagos.montoInterno[5] + 
                    config.pagos.montoExterno[5] + 
                    config.pagos.montoRecuperado[5] + 
                    config.pagos.cantidad[5] + 
                    config.pagos.equipo[5];
                alert(`Vista previa de cambios:\n\n` +
                      `Base: ${formatearGuaranies(config.base)} Gs\n` +
                      `Máximo subtotal calculado: ${formatearGuaranies(maxSubtotal)} Gs\n\n` +
                      `Ejemplo para nivel Genio:\n` +
                      `- Meta Interno: ${formatearGuaranies(config.metas.montoInterno[5])} Gs\n` +
                      `- Premio Interno: ${formatearGuaranies(config.pagos.montoInterno[5])} Gs\n` +
                      `- Meta Cantidad: ${config.metas.cantidad[5]} desembolsos\n` +
                      `- Premio Cantidad: ${formatearGuaranies(config.pagos.cantidad[5])} Gs`);
            } catch (e) {
                // Error ya mostrado en getCurrentConfig
            }
        }
        
        // Guardar en localStorage
        function saveToLocal() {
            try {
                const config = getCurrentConfig();
                localStorage.setItem('comisionesConfig', JSON.stringify(config));
                const success = document.getElementById('saveSuccess');
                success.innerHTML = '✅ Configuración guardada en el navegador exitosamente';
                success.style.display = 'block';
                setTimeout(() => {
                    success.style.display = 'none';
                }, 3000);
            } catch (e) {
                // Error ya mostrado en getCurrentConfig
            }
        }
        
        // Generar config.js y descargarlo automáticamente
        function generateConfig() {
            try {
                const config = getCurrentConfig();
                const configContent = `// Configuración del Sistema de Comisiones Comerciales\n// Este archivo contiene todos los valores configurables del sistema\n// Para modificar valores, usar /admin.html\n\nconst CONFIG = ${JSON.stringify(config, null, 4)};`;
                
                // Crear y descargar el archivo directamente
                const blob = new Blob([configContent], { type: 'text/javascript' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'config.js';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                // Mostrar mensaje de éxito
                const success = document.getElementById('saveSuccess');
                success.innerHTML = '✅ Archivo config.js exportado exitosamente';
                success.style.display = 'block';
                setTimeout(() => {
                    success.style.display = 'none';
                }, 3000);
            } catch (e) {
                // Error ya mostrado en getCurrentConfig
            }
        }
        
        // Copiar al portapapeles
        function copyToClipboard() {
            const textarea = document.getElementById('configOutput');
            textarea.select();
            document.execCommand('copy');
            alert('✅ Código copiado al portapapeles');
        }
        
        // Descargar config.js
        function downloadConfig() {
            const content = document.getElementById('configOutput').value;
            const blob = new Blob([content], { type: 'text/javascript' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'config.js';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // Restaurar valores por defecto
        function resetDefaults() {
            if (confirm('¿Estás seguro de restaurar todos los valores por defecto?\n\nEsto sobrescribirá todos los cambios actuales.')) {
                localStorage.removeItem('comisionesConfig');
                // Cargar valores por defecto desde CONFIG original
                if (typeof CONFIG !== 'undefined') {
                    localStorage.setItem('comisionesConfig', JSON.stringify(CONFIG));
                }
                loadValues();
                
                // Mostrar mensaje de éxito
                const success = document.getElementById('saveSuccess');
                success.innerHTML = '✅ Valores restaurados a la configuración por defecto';
                success.style.display = 'block';
                setTimeout(() => {
                    success.style.display = 'none';
                }, 3000);
            }
        }
        
        // Cargar valores al iniciar
        window.onload = function() {
            loadValues();
        };
    </script>
</body>
</html>
